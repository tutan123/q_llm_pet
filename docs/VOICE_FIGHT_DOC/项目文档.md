# VOICE_FIGHT 语音格斗游戏 - 项目文档

**版本**: v1.0  
**日期**: 2025-01-01  
**项目负责人**: 开发团队

---

## 一、项目概述

### 1.1 项目背景

VOICE_FIGHT 是一个创新的语音交互格斗游戏项目，旨在通过语音指令和 AI 技术（FunctionGemma + 行为树）实现自然、流畅的格斗游戏体验。

### 1.2 项目目标

- **技术目标**：实现基于语音指令的实时格斗系统
- **产品目标**：提供流畅、有趣的语音交互格斗体验
- **学习目标**：验证 FunctionGemma + 行为树在游戏领域的应用

### 1.3 项目范围

**包含**：
- 语音输入与识别系统
- LLM 招式识别系统
- 行为树战斗控制系统
- 3D 战斗场景与角色动画
- 战斗 UI 系统

**不包含**（MVP 阶段）：
- 多人对战模式
- 角色自定义系统
- 在线排行榜
- 付费系统

---

## 二、项目架构

### 2.1 技术栈

#### 前端技术
- **框架**: React + TypeScript
- **3D 渲染**: Three.js / React Three Fiber
- **状态管理**: React Hooks + Context API
- **UI 库**: Tailwind CSS
- **构建工具**: Vite

#### AI 技术
- **LLM**: FunctionGemma 270M（本地部署）
- **语音识别**: Web Speech API（优先） / 备选在线服务
- **行为树**: 基于 behavior3js 的自定义实现

#### 后端技术（可选）
- **LLM 服务**: vLLM（本地部署）
- **API 服务**: FastAPI（如需要在线语音识别）

### 2.2 项目结构

```
GAME/VOICE_FIGHT/
├── docs/                          # 文档目录
│   ├── PRD_语音格斗游戏.md
│   ├── 项目文档.md
│   └── 技术文档.md
├── src/
│   ├── components/                # React 组件
│   │   ├── BattleScene/          # 战斗场景组件
│   │   ├── UI/                   # UI 组件
│   │   └── VoiceInput/           # 语音输入组件
│   ├── services/                 # 服务层
│   │   ├── bt/                   # 行为树系统
│   │   │   ├── core/             # 核心类（BaseNode, Composite, etc.）
│   │   │   ├── actions/         # 动作节点
│   │   │   ├── conditions/       # 条件节点
│   │   │   └── composites/      # 复合节点
│   │   ├── llm/                  # LLM 服务
│   │   │   ├── functionGemmaService.ts
│   │   │   └── moveRecognitionService.ts
│   │   ├── voice/                # 语音服务
│   │   │   ├── speechRecognition.ts
│   │   │   └── voiceFeedback.ts
│   │   └── battle/               # 战斗系统
│   │       ├── battleEngine.ts
│   │       ├── moveSystem.ts
│   │       └── comboSystem.ts
│   ├── types/                     # TypeScript 类型定义
│   │   ├── battle.ts
│   │   ├── moves.ts
│   │   └── bt.ts
│   ├── constants/                # 常量定义
│   │   ├── moves.ts              # 招式定义
│   │   └── battle.ts             # 战斗常量
│   ├── utils/                     # 工具函数
│   └── App.tsx                   # 主应用入口
├── public/                        # 静态资源
│   ├── models/                   # 3D 模型
│   ├── animations/               # 动画文件
│   └── sounds/                   # 音效文件
├── tests/                        # 测试文件
│   ├── unit/                     # 单元测试
│   └── integration/              # 集成测试
├── package.json
├── tsconfig.json
└── vite.config.ts
```

---

## 三、开发计划

### 3.1 开发阶段

#### Phase 1: 基础架构搭建（2 周）

**目标**：搭建项目基础架构，实现核心系统框架

**任务清单**：
- [ ] 项目初始化（React + TypeScript + Vite）
- [ ] 行为树系统集成（参考 q_pet 实现）
- [ ] 基础 3D 场景搭建（Three.js）
- [ ] 角色模型加载与基础动画
- [ ] 黑板系统实现（三层作用域）
- [ ] BT Driver 模式实现

**交付物**：
- 可运行的基础项目
- 行为树系统框架
- 基础 3D 场景

#### Phase 2: 语音识别系统（1 周）

**目标**：实现语音输入与识别功能

**任务清单**：
- [ ] Web Speech API 集成
- [ ] 语音识别服务封装
- [ ] 语音输入 UI 组件
- [ ] 噪音过滤与优化
- [ ] 离线/在线模式切换

**交付物**：
- 语音识别功能
- 语音输入 UI

#### Phase 3: LLM 招式识别（2 周）

**目标**：实现基于 FunctionGemma 的招式识别系统

**任务清单**：
- [ ] FunctionGemma 服务集成（参考 q_pet）
- [ ] 招式识别 LLM 节点（MoveRecognitionNode）
- [ ] 招式解析节点（MoveParseNode）
- [ ] 招式工具定义（Function Calling）
- [ ] LLM 调用优化（缓存、去重）
- [ ] 错误处理与兜底机制

**交付物**：
- LLM 招式识别功能
- 招式解析系统

#### Phase 4: 战斗系统核心（2 周）

**目标**：实现核心战斗逻辑

**任务清单**：
- [ ] 战斗引擎实现
- [ ] 招式执行系统
- [ ] HP/Energy 系统
- [ ] 伤害计算系统
- [ ] 防御/闪避系统
- [ ] 战斗状态管理

**交付物**：
- 可运行的战斗系统
- 基础战斗逻辑

#### Phase 5: 组合技系统（1.5 周）

**目标**：实现组合技识别与执行

**任务清单**：
- [ ] 组合技识别逻辑
- [ ] 组合技序列优化
- [ ] 连击系统
- [ ] 连击伤害加成
- [ ] 组合技冷却系统

**交付物**：
- 组合技系统
- 连击系统

#### Phase 6: UI/UX 完善（1.5 周）

**目标**：完善用户界面与交互体验

**任务清单**：
- [ ] 战斗 UI 设计
- [ ] HP/Energy 条实现
- [ ] 连击数显示
- [ ] 招式列表 UI
- [ ] 语音输入指示器
- [ ] 伤害数字显示
- [ ] 音效系统

**交付物**：
- 完整的战斗 UI
- 音效系统

#### Phase 7: 测试与优化（1 周）

**目标**：测试、优化与 Bug 修复

**任务清单**：
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能优化
- [ ] Bug 修复
- [ ] 用户体验优化

**交付物**：
- 测试报告
- 优化后的游戏

### 3.2 里程碑

| 里程碑 | 时间 | 交付物 |
|--------|------|--------|
| M1: 基础架构完成 | Week 2 | 可运行的基础项目 |
| M2: 语音识别完成 | Week 3 | 语音输入功能 |
| M3: LLM 识别完成 | Week 5 | 招式识别功能 |
| M4: 战斗系统完成 | Week 7 | 可玩的战斗系统 |
| M5: 组合技完成 | Week 8.5 | 完整战斗系统 |
| M6: UI 完善 | Week 10 | 完整游戏 |
| M7: 测试完成 | Week 11 | 发布版本 |

---

## 四、团队分工

### 4.1 角色定义

**前端开发工程师**（2 人）
- 负责 React 组件开发
- 负责 3D 场景与动画
- 负责 UI 实现

**AI 工程师**（1 人）
- 负责 LLM 集成与优化
- 负责行为树系统
- 负责招式识别逻辑

**游戏逻辑工程师**（1 人）
- 负责战斗系统
- 负责招式系统
- 负责组合技系统

**测试工程师**（1 人，兼职）
- 负责测试用例编写
- 负责性能测试
- 负责用户体验测试

### 4.2 协作方式

- **每日站会**：每天 15 分钟同步进度
- **周会**：每周总结与计划
- **代码审查**：所有 PR 需要至少一人审查
- **文档同步**：重要决策记录在文档中

---

## 五、技术风险与应对

### 5.1 技术风险

#### 风险 1: LLM 识别准确率低

**影响**: 高  
**概率**: 中  
**应对措施**:
- 优化 FunctionGemma 提示词
- 增加规则兜底机制
- 收集用户反馈，持续优化数据集
- 考虑使用更大的模型（如 2B）作为备选

#### 风险 2: 语音识别延迟高

**影响**: 中  
**概率**: 中  
**应对措施**:
- 优先使用本地 Web Speech API
- 优化识别算法
- 实现语音缓存机制
- 备选在线服务（如需要）

#### 风险 3: 性能问题

**影响**: 中  
**概率**: 低  
**应对措施**:
- 早期性能测试
- 优化 3D 渲染（LOD、批处理）
- 优化行为树执行频率
- 使用 Web Worker 处理 LLM 调用

#### 风险 4: 行为树复杂度高

**影响**: 中  
**概率**: 低  
**应对措施**:
- 参考 q_pet 的成熟实现
- 模块化设计，逐步构建
- 充分测试每个节点

### 5.2 依赖风险

- **FunctionGemma 模型可用性**：确保模型文件可访问
- **Web Speech API 浏览器支持**：提供备选方案
- **3D 模型资源**：提前准备或使用占位模型

---

## 六、质量保证

### 6.1 代码质量

- **代码规范**: ESLint + Prettier
- **类型检查**: TypeScript 严格模式
- **代码审查**: 所有 PR 必须经过审查
- **文档**: 关键函数和类必须有注释

### 6.2 测试策略

- **单元测试**: 核心逻辑（战斗系统、招式系统）
- **集成测试**: LLM 调用、行为树执行
- **E2E 测试**: 完整战斗流程
- **性能测试**: 帧率、内存、延迟

### 6.3 用户体验测试

- **可用性测试**: 邀请 5-10 名用户测试
- **A/B 测试**: UI 布局、交互方式
- **反馈收集**: 建立反馈渠道

---

## 七、部署计划

### 7.1 开发环境

- **本地开发**: Vite Dev Server
- **LLM 服务**: 本地 vLLM 服务
- **版本控制**: Git + GitHub

### 7.2 测试环境

- **部署平台**: Vercel / Netlify
- **LLM 服务**: 测试服务器
- **测试数据**: 模拟战斗数据

### 7.3 生产环境

- **部署平台**: Vercel / Netlify（静态部署）
- **LLM 服务**: 用户本地部署（推荐）或云端服务
- **CDN**: 静态资源 CDN 加速

---

## 八、项目资源

### 8.1 人力资源

- **开发团队**: 4 人
- **测试**: 1 人（兼职）
- **预计总工时**: 约 400 小时

### 8.2 技术资源

- **参考项目**: Q-Penguin (q_pet)
- **文档**: 
  - Q-Penguin 行为树架构文档
  - FunctionGemma 使用文档
  - Web Speech API 文档

### 8.3 外部资源

- **3D 模型**: 需要准备角色模型和动画
- **音效**: 需要准备战斗音效
- **LLM 模型**: FunctionGemma 270M 模型文件

---

## 九、成功标准

### 9.1 功能完整性

- ✅ 语音输入与识别功能正常
- ✅ LLM 招式识别准确率 > 85%
- ✅ 战斗系统稳定运行
- ✅ 组合技系统正常工作
- ✅ UI 完整且易用

### 9.2 性能指标

- ✅ 帧率稳定在 60 FPS
- ✅ 语音识别延迟 < 500ms
- ✅ LLM 调用延迟 < 1.5s
- ✅ 内存占用 < 500MB

### 9.3 用户体验

- ✅ 用户满意度 > 4.0/5.0
- ✅ 平均游戏时长 > 15 分钟
- ✅ 7 日留存率 > 30%

---

## 十、后续规划

### 10.1 短期优化（1-2 个月）

- 性能优化
- UI/UX 优化
- 招式平衡性调整
- 用户反馈处理

### 10.2 中期扩展（3-6 个月）

- 多人对战模式
- 角色自定义系统
- 更多招式类型
- 成就系统

### 10.3 长期规划（6 个月+）

- 移动端适配
- 在线排行榜
- 社区功能
- 商业化探索

---

**文档状态**: ✅ 已完成  
**下一步**: 技术文档编写

