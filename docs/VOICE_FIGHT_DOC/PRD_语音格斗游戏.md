# VOICE_FIGHT 语音格斗游戏 - 产品需求文档 (PRD)

**版本**: v1.0  
**日期**: 2025-01-01  
**作者**: 产品团队

---

## 一、产品概述

### 1.1 产品定位

VOICE_FIGHT 是一款基于**语音指令驱动的实时格斗游戏**，玩家通过**语音输入**控制角色执行各种格斗招式，支持**组合技（搓招）**系统，实现流畅的语音交互式格斗体验。

### 1.2 核心价值

- **创新交互方式**：语音指令替代传统按键操作，解放双手
- **自然语言理解**：支持自然语言描述招式（如"左勾拳接右踢腿"）
- **智能招式识别**：基于 FunctionGemma LLM 理解玩家意图，转换为精确的招式序列
- **组合技系统**：支持复杂招式组合，提升战斗策略性

### 1.3 目标用户

- **核心用户**：18-35 岁，喜欢格斗游戏和语音交互的玩家
- **次要用户**：对 AI 交互感兴趣的科技爱好者
- **潜在用户**：需要无障碍操作的游戏玩家

---

## 二、功能需求

### 2.1 核心功能

#### 2.1.1 语音输入系统

**功能描述**：
- 玩家通过麦克风输入语音指令
- 支持实时语音识别（STT - Speech to Text）
- 支持离线/在线两种模式

**输入示例**：
- "左勾拳"
- "右踢腿接左直拳"
- "连续三下重拳"
- "防御后反击"

**技术要求**：
- 响应延迟 < 500ms（本地识别）
- 识别准确率 > 90%
- 支持中文语音识别
- 支持噪音过滤

#### 2.1.2 招式识别与执行系统

**功能描述**：
- 使用 FunctionGemma LLM 将语音文本转换为招式序列
- 支持单招式和组合招式
- 招式执行有冷却时间、伤害值、能量消耗等属性

**招式类型**：
- **基础招式**：直拳、勾拳、踢腿、防御、闪避
- **组合招式**：左勾拳+右踢腿、连续重拳、防御反击
- **特殊招式**：必杀技、连击技（需要能量或连击数）

**招式属性**：
```typescript
interface Move {
  id: string;              // 招式ID
  name: string;            // 招式名称
  type: 'attack' | 'defense' | 'dodge' | 'combo';  // 招式类型
  damage: number;          // 伤害值
  energyCost: number;      // 能量消耗
  cooldown: number;        // 冷却时间（秒）
  duration: number;        // 执行时长（秒）
  comboPoints: number;     // 连击点数
  animation: string;       // 动画名称
}
```

#### 2.1.3 战斗系统

**功能描述**：
- 实时战斗，玩家角色 vs AI 对手
- 生命值（HP）、能量值（Energy）、连击数（Combo）系统
- 伤害计算、防御减伤、闪避判定

**战斗规则**：
- **生命值**：初始 100，归零则失败
- **能量值**：初始 50，使用招式消耗，随时间恢复
- **连击数**：连续命中增加连击，连击数越高伤害加成越高
- **防御**：减少 50% 伤害，消耗能量
- **闪避**：完全躲避攻击，消耗能量

#### 2.1.4 组合技系统（搓招）

**功能描述**：
- 玩家可以通过语音描述多个招式，系统自动组合为连击
- 支持招式序列优化（如"左勾拳接右踢腿"自动优化为流畅连击）
- 组合技有额外伤害加成

**组合技示例**：
- "左勾拳接右踢腿" → `[LEFT_HOOK, RIGHT_KICK]` → 伤害 +20%
- "连续三下重拳" → `[HEAVY_PUNCH, HEAVY_PUNCH, HEAVY_PUNCH]` → 伤害 +30%
- "防御后反击" → `[DEFEND, COUNTER_ATTACK]` → 伤害 +40%

**组合技规则**：
- 最多支持 5 个招式组合
- 组合技总时长不超过 3 秒
- 组合技总能量消耗不超过当前能量值
- 组合技有 2 秒冷却时间

### 2.2 辅助功能

#### 2.2.1 战斗状态显示

- **UI 元素**：
  - 玩家 HP 条
  - 玩家 Energy 条
  - 对手 HP 条
  - 连击数显示
  - 招式冷却时间显示
  - 当前招式名称显示

#### 2.2.2 语音反馈系统

- 招式执行时播放语音提示
- 连击达成时播放激励语音
- 战斗胜利/失败语音

#### 2.2.3 战斗回放系统

- 记录战斗过程
- 支持回放查看
- 支持招式分析（命中率、连击数等）

---

## 三、非功能需求

### 3.1 性能要求

- **帧率**：稳定 60 FPS
- **响应延迟**：
  - 语音识别延迟 < 500ms（本地）
  - LLM 调用延迟 < 1.5s
  - 招式执行延迟 < 100ms
- **内存占用**：< 500MB
- **CPU 占用**：< 30%（单核）

### 3.2 兼容性要求

- **浏览器**：Chrome 90+, Firefox 88+, Edge 90+
- **操作系统**：Windows 10+, macOS 11+, Linux（主流发行版）
- **硬件要求**：
  - 麦克风（必需）
  - 独立显卡（推荐）
  - 4GB RAM（最低）

### 3.3 可访问性要求

- 支持字幕显示（招式名称、战斗提示）
- 支持键盘快捷键（作为语音输入的备选方案）
- 支持音量调节

### 3.4 安全性要求

- 语音数据本地处理，不上传服务器（离线模式）
- 在线模式需用户明确授权
- 不收集用户隐私信息

---

## 四、用户故事

### 4.1 核心用户故事

**US-001：语音输入招式**
- **作为** 玩家
- **我想要** 通过语音说出"左勾拳"
- **以便** 角色执行左勾拳攻击

**US-002：组合技执行**
- **作为** 玩家
- **我想要** 通过语音说出"左勾拳接右踢腿"
- **以便** 角色执行流畅的组合技连击

**US-003：战斗状态查看**
- **作为** 玩家
- **我想要** 实时查看我的生命值和能量值
- **以便** 合理规划招式使用

**US-004：连击系统**
- **作为** 玩家
- **我想要** 连续命中对手
- **以便** 获得连击加成，造成更高伤害

### 4.2 扩展用户故事

**US-005：招式冷却管理**
- **作为** 玩家
- **我想要** 知道哪些招式还在冷却中
- **以便** 选择可用的招式

**US-006：能量管理**
- **作为** 玩家
- **我想要** 知道当前能量值
- **以便** 决定是否使用高能量消耗的必杀技

**US-007：战斗回放**
- **作为** 玩家
- **我想要** 回放刚才的战斗
- **以便** 分析自己的操作和提升技巧

---

## 五、界面设计需求

### 5.1 主界面

- **战斗区域**：3D 角色模型，实时战斗动画
- **状态栏**：HP、Energy、Combo 显示
- **语音输入指示器**：显示当前是否在接收语音
- **招式列表**：显示可用招式及其冷却状态

### 5.2 战斗界面布局

```
┌─────────────────────────────────────┐
│  [对手HP条]              [连击数: 5] │
│                                     │
│         [3D战斗场景]                │
│                                     │
│  [玩家HP条]  [Energy条]            │
│  [语音输入指示器]                    │
│  [招式列表]                          │
└─────────────────────────────────────┘
```

### 5.3 交互反馈

- **语音识别中**：显示波形动画
- **招式执行中**：显示招式名称和动画
- **连击达成**：显示连击数动画
- **伤害显示**：浮动的伤害数字

---

## 六、技术约束

### 6.1 LLM 约束

- 使用 FunctionGemma 270M 模型（本地部署）
- LLM 调用延迟 < 1.5s
- 支持离线运行

### 6.2 行为树约束

- 使用行为树系统控制战斗逻辑
- 支持异步 LLM 调用
- 支持招式序列执行

### 6.3 语音识别约束

- 优先使用本地语音识别（Web Speech API）
- 备选方案：在线语音识别服务
- 支持中文识别

---

## 七、成功指标

### 7.1 用户体验指标

- **语音识别准确率**：> 90%
- **招式识别准确率**：> 85%
- **平均响应延迟**：< 1s
- **用户满意度**：> 4.0/5.0

### 7.2 技术指标

- **帧率稳定性**：60 FPS ± 2
- **内存占用**：< 500MB
- **LLM 调用成功率**：> 95%
- **战斗系统稳定性**：无崩溃运行 > 1 小时

### 7.3 业务指标

- **用户留存率**（7 日）：> 30%
- **平均游戏时长**：> 15 分钟
- **组合技使用率**：> 50%

---

## 八、开发优先级

### 8.1 MVP（最小可行产品）

**Phase 1 - 核心战斗系统**
1. 基础招式系统（5 个基础招式）
2. 语音输入与识别
3. LLM 招式识别
4. 简单战斗系统（HP、伤害计算）
5. 基础 UI

**Phase 2 - 组合技系统**
1. 组合技识别与执行
2. 连击系统
3. 能量系统
4. 冷却系统

**Phase 3 - 优化与扩展**
1. 战斗回放
2. 招式分析
3. 性能优化
4. UI/UX 优化

### 8.2 未来扩展

- 多人对战模式
- 角色自定义系统
- 招式编辑器
- 排行榜系统
- 成就系统

---

## 九、风险评估

### 9.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| LLM 识别准确率低 | 高 | 中 | 优化数据集，增加规则兜底 |
| 语音识别延迟高 | 中 | 中 | 使用本地识别，优化算法 |
| 性能问题 | 中 | 低 | 性能测试，优化渲染 |

### 9.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 用户不习惯语音操作 | 高 | 中 | 提供键盘备选方案，优化引导 |
| 组合技识别困难 | 中 | 中 | 优化 LLM 提示词，增加示例 |

---

## 十、附录

### 10.1 术语表

- **STT**：Speech to Text，语音转文本
- **LLM**：Large Language Model，大语言模型
- **BT**：Behavior Tree，行为树
- **Combo**：连击，连续命中
- **Energy**：能量值，用于释放招式
- **Cooldown**：冷却时间，招式使用间隔

### 10.2 参考文档

- Q-Penguin 行为树架构文档
- FunctionGemma 使用文档
- Web Speech API 文档

---

**文档状态**: ✅ 已完成  
**下一步**: 项目文档编写

